{% extends "base.html" %}
{% block title %}플레이리스트 | 2beats{% endblock %}
{% block content %}
  <div style="margin-bottom:10px;">
    <a class="muted" href="{% url 'mylist' %}">← 마이 리스트로</a>
  </div>

  <div class="card" style="margin-bottom:14px;">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
      <div>
        <p class="pill-label" style="margin:0 0 8px;">{% if is_music %}음악{% else %}영상{% endif %} 플레이리스트</p>
        <h1 style="margin:0 0 6px;">{{ playlist.folder_name }}</h1>
        <p class="muted" style="margin:0;">생성일 {{ playlist.created_at|date:"Y-m-d H:i" }}</p>
      </div>
    </div>
  </div>

  <div class="card" style="margin-bottom:14px;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:8px;">
      <h3 style="margin:0;">현재 목록</h3>
      {% if items %}
        <span class="muted">순서를 수정한 뒤 저장을 눌러주세요.</span>
      {% endif %}
    </div>
    {% if items %}
      <form method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="action" value="reorder">
        <table>
          <thead>
            <tr>
              <th>순서</th>
              <th>{{ is_music|yesno:"음악,영상" }} 제목</th>
              <th>아티스트</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
              <tr>
                <td><input type="number" name="order_{{ item.id }}" value="{{ item.order }}" min="1" style="width:80px; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#0c0a18; color:var(--text);"></td>
                <td>
                  {% if is_music %}
                    {{ item.music.music_title }}
                  {% else %}
                    {{ item.video.video_title }}
                  {% endif %}
                </td>
                <td class="muted">
                  {% if is_music %}
                    {{ item.music.music_singer }}
                  {% else %}
                    {{ item.video.video_singer }}
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <div style="margin-top:10px;">
          <button type="submit" class="btn btn-primary" style="border:none;">순서 저장</button>
        </div>
      </form>
    {% else %}
      <p class="muted" style="margin:0;">아직 아이템이 없습니다. 아래에서 추가해 보세요.</p>
    {% endif %}
  </div>

  <div class="card card-plain">
    <h3 style="margin:0 0 10px;">아이템 추가</h3>
    <form method="post" action="" style="display:grid; gap:10px;">
      {% csrf_token %}
      <input type="hidden" name="action" value="add">
      <div>
        <label class="muted">{{ is_music|yesno:"음악,영상" }} 선택</label>
        {% if is_music %}
          {{ form.music }}
        {% else %}
          {{ form.video }}
        {% endif %}
      </div>
      <div>
        <label for="{{ form.order.id_for_label }}" class="muted">순서 (옵션)</label>
        {{ form.order }}
        <p class="muted" style="margin:6px 0 0; font-size:12px;">비워두면 마지막 순서에 추가됩니다.</p>
      </div>
      <button type="submit" class="btn btn-secondary" style="border:none; width:140px;">추가</button>
    </form>
  </div>
{% endblock %}
